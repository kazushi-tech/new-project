# プラン: abstract-floating-bubble.md をレビュープラットフォーム + GitHub連携に全面改訂

## Context

`plans/abstract-floating-bubble.md` は現在「AI要件定義・設計書**自動生成**サービス」として設計されている。
これを「人間主導の要件定義**レビュー**・整合性チェックプラットフォーム」に全面改修し、
**GitHub連携を必須要件**として中核フローに組み込む。

**方針**: AIは一切ドキュメントを生成・確定しない。要件定義も設計書も人間が作成し、AIは添削・整合性チェック・改善提案のみを行う。全フローはGitHub PR駆動で実行される。

## 対象ファイル

- `plans/abstract-floating-bubble.md`（単一ファイル、全面改訂）

## 新しい処理パイプライン（4ステップ）

| Step | 名称 | 主体 | GitHub上の動作 |
|------|------|------|---------------|
| Step 1 | Human Draft | 人間 | `feat/requirements-*` ブランチでPR作成 |
| Step 2 | AI Review | AI（並列） | GitHub ActionsでAIレビュー → PRコメント/Check Run返却 |
| Step 3 | Human Fix & Approval | 人間 | 修正コミット → CODEOWNERS承認 → マージ |
| Step 4 | Approved Spec Export | AI+人間 | mainから承認済み要件を読み取り、設計展開 |

## 14項目の編集内容

### 1. タイトル + 冒頭の価値提案
- 「AI要件定義・設計書自動生成サービス」→「AI要件レビュー・整合性検証サービス（SpecForge Review）」
- Context: 「自動生成する」→「添削・整合性チェックする」
- 基本原則ブロック追加（人間作成必須、AI提案のみ、GitHub連携必須）

### 2. アーキテクチャ図
- 入力源: 「人間がGitHub上で作成した要件ドキュメント」
- フロー: 「PR作成 → GitHub Actions → AIレビュー → PRコメント → 修正 → 承認 → マージ → 設計展開」
- 4ステップ図に全面差替え

### 3. ステップ定義
- Step 1〜4を明確に定義（上表の通り）

### 4. GitHub連携セクション（新設）
- GitHub Actions ワークフロー（`.github/workflows/requirements-review.yml`）
- PR駆動レビューフロー（6段階）
- 必須ブランチ保護ルール
- 必須テンプレート一覧

### 5. GitHub運用ルール（新設）
- ブランチ戦略（`feat/requirements-*`）
- リポジトリ構成（`requirements/`, `reviews/`）
- CODEOWNERS例、PRテンプレート概要

### 6. AIの禁止事項（新設）
- 要件の断定追加、意味変更、人間承認なしの確定操作、`[AI提案]`タグなしの提案、承認済み要件の事後変更

### 7. AIの許可事項（新設）
- 曖昧表現指摘、抜け漏れ質問、影響範囲可視化、テスト観点指摘、API/DB整合性指摘、改善提案

### 8. 出力物一覧の見直し
- Step 2: レビュー成果物（レビュー報告書、指摘一覧、未解決論点）
- Step 4: 設計展開成果物（レビュー観点、見積ドラフト）
- 横断: 承認履歴、レビュー履歴

### 9. 整合性ルール明確化
- トレーサビリティチェーン図
- 6項目のチェック表（孤立ID、CRUD対応、フォーム↔API整合性等）

### 10. セキュリティ/監査
- 既存セクション維持 + 監査ログに「承認・差し戻し」追加
- 秘匿情報マスキング機能追加
- RBAC表の追加

### 11. コスト管理（新設）
- PRあたりトークン上限、タイムアウト、レビューサイクル上限、日次上限
- コスト超過時の挙動

### 12. 失敗時リカバリ（新設）
- 各Step失敗時のリカバリ方法表
- 冪等性の保証（重複コメント防止、差分レビュー）

### 13. 実装フェーズ調整
- Phase 1: **GitHub連携MVP**（GitHub Actions + 1エージェントレビュー + PRコメント返却）
- Phase 2: マルチエージェント + 承認ゲート + コスト管理
- Phase 3: Web UI + 設計展開
- Phase 4: 商用化（複数承認者、秘匿マスキング等）

### 14. Mermaid記法修正
- 既に4バッククォートネスト修正済み。追加の記法崩れがあれば同時修正

## 実装方法

ほぼ全セクションが変更対象のため、`Write` ツールによるファイル全体書き換えを実施する。
変更量は既存568行 → 約650行程度を想定。

## 検証方法

1. 全文通読: 「自動生成」「生成する」が不適切に残っていないか
2. GitHub連携: 必須要件として4箇所以上（フロー、セクション、Phase 1、検証計画）に反映されているか
3. 承認ゲート: 図、フロー、UI画面、コード例、Phase、検証の6箇所で一貫しているか
4. AIガードレール: Context、禁止事項セクション、ルール、検証の4箇所に反映されているか
5. Markdown構文: 崩れなし
